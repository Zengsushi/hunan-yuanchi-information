{"ast":null,"code":"import { computed, ref, onMounted } from 'vue';\nimport MetricCard from './MetricCard.vue';\nexport default {\n  __name: 'DynamicMetrics',\n  props: {\n    // JSON 配置数据\n    config: {\n      type: Object,\n      default: () => ({\n        grid: {\n          columns: 'repeat(auto-fit, minmax(280px, 1fr))',\n          gap: '24px',\n          responsive: {\n            mobile: 'repeat(1, 1fr)',\n            tablet: 'repeat(2, 1fr)'\n          }\n        },\n        animation: {\n          enabled: true,\n          delay: 0.1\n        }\n      })\n    },\n    // 指标数据数组\n    metrics: {\n      type: Array,\n      default: () => []\n    },\n    // 网格布局配置\n    gridColumns: {\n      type: String,\n      default: 'repeat(auto-fit, minmax(200px, 1fr))'\n    },\n    // 网格间距\n    gridGap: {\n      type: String,\n      default: '16px'\n    },\n    // 是否启用动画\n    enableAnimation: {\n      type: Boolean,\n      default: true\n    }\n  },\n  emits: ['metric-click', 'metrics-loaded'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    const props = __props;\n    const emit = __emit;\n    const metricsData = computed(() => {\n      if (props.metrics && props.metrics.length > 0) {\n        return props.metrics;\n      }\n      return props.config.metrics || [];\n    });\n    const gridStyle = computed(() => {\n      const columns = props.gridColumns || props.config.grid?.columns || 'repeat(auto-fit, minmax(200px, 1fr))';\n      const gap = props.gridGap || props.config.grid?.gap || '16px';\n      return {\n        display: 'grid',\n        gridTemplateColumns: columns,\n        gap: gap\n      };\n    });\n    const getMetricAnimation = index => {\n      const animationEnabled = props.enableAnimation && props.config.animation?.enabled !== false;\n      if (!animationEnabled) return {};\n      const delay = (props.config.animation?.delay || 0.1) * index;\n      return {\n        animation: `fadeIn 0.6s ease-out ${delay}s both`\n      };\n    };\n\n    // 从 API 获取数据的方法\n    const fetchMetrics = async apiUrl => {\n      try {\n        const response = await fetch(apiUrl);\n        const data = await response.json();\n        emit('metrics-loaded', data);\n        return data;\n      } catch (error) {\n        console.error('获取指标数据失败:', error);\n        return [];\n      }\n    };\n\n    // 更新单个指标数据\n    const updateMetric = (metricId, newData) => {\n      const index = metricsData.value.findIndex(m => m.id === metricId);\n      if (index !== -1) {\n        Object.assign(metricsData.value[index], newData);\n      }\n    };\n\n    // 添加新指标\n    const addMetric = metric => {\n      metricsData.value.push(metric);\n    };\n\n    // 移除指标\n    const removeMetric = metricId => {\n      const index = metricsData.value.findIndex(m => m.id === metricId);\n      if (index !== -1) {\n        metricsData.value.splice(index, 1);\n      }\n    };\n\n    // 暴露方法给父组件使用\n    __expose({\n      fetchMetrics,\n      updateMetric,\n      addMetric,\n      removeMetric\n    });\n    onMounted(() => {\n      // 如果配置中有 API URL，自动获取数据\n      if (props.config.apiUrl) {\n        fetchMetrics(props.config.apiUrl);\n      }\n    });\n    const __returned__ = {\n      props,\n      emit,\n      metricsData,\n      gridStyle,\n      getMetricAnimation,\n      fetchMetrics,\n      updateMetric,\n      addMetric,\n      removeMetric,\n      computed,\n      ref,\n      onMounted,\n      MetricCard\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["computed","ref","onMounted","MetricCard","props","__props","emit","__emit","metricsData","metrics","length","config","gridStyle","columns","gridColumns","grid","gap","gridGap","display","gridTemplateColumns","getMetricAnimation","index","animationEnabled","enableAnimation","animation","enabled","delay","fetchMetrics","apiUrl","response","fetch","data","json","error","console","updateMetric","metricId","newData","value","findIndex","m","id","Object","assign","addMetric","metric","push","removeMetric","splice","__expose"],"sources":["E:/A_project/yuanchi/AIops/frontend/src/components/business/DynamicMetrics.vue"],"sourcesContent":["<template>\r\n  <div class=\"dynamic-metrics-container\">\r\n    <div \r\n      class=\"metrics-grid\" \r\n      :style=\"gridStyle\"\r\n    >\r\n      <MetricCard \r\n        v-for=\"(metric, index) in metricsData\" \r\n        :key=\"metric.id || index\"\r\n        :metric=\"metric\"\r\n        :style=\"getMetricAnimation(index)\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { computed, ref, onMounted } from 'vue';\r\nimport MetricCard from './MetricCard.vue';\r\n\r\nconst props = defineProps({\r\n  // JSON 配置数据\r\n  config: {\r\n    type: Object,\r\n    default: () => ({\r\n      grid: {\r\n        columns: 'repeat(auto-fit, minmax(280px, 1fr))',\r\n        gap: '24px',\r\n        responsive: {\r\n          mobile: 'repeat(1, 1fr)',\r\n          tablet: 'repeat(2, 1fr)'\r\n        }\r\n      },\r\n      animation: {\r\n        enabled: true,\r\n        delay: 0.1\r\n      }\r\n    })\r\n  },\r\n  \r\n  // 指标数据数组\r\n  metrics: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n\r\n  // 网格布局配置\r\n  gridColumns: {\r\n    type: String,\r\n    default: 'repeat(auto-fit, minmax(200px, 1fr))'\r\n  },\r\n\r\n  // 网格间距\r\n  gridGap: {\r\n    type: String,\r\n    default: '16px'\r\n  },\r\n\r\n  // 是否启用动画\r\n  enableAnimation: {\r\n    type: Boolean,\r\n    default: true\r\n  }\r\n});\r\n\r\nconst emit = defineEmits(['metric-click', 'metrics-loaded']);\r\n\r\nconst metricsData = computed(() => {\r\n  if (props.metrics && props.metrics.length > 0) {\r\n    return props.metrics;\r\n  }\r\n  \r\n  return props.config.metrics || [];\r\n});\r\n\r\nconst gridStyle = computed(() => {\r\n  const columns = props.gridColumns || props.config.grid?.columns || 'repeat(auto-fit, minmax(200px, 1fr))';\r\n  const gap = props.gridGap || props.config.grid?.gap || '16px';\r\n  \r\n  return {\r\n    display: 'grid',\r\n    gridTemplateColumns: columns,\r\n    gap: gap\r\n  };\r\n});\r\n\r\nconst getMetricAnimation = (index) => {\r\n  const animationEnabled = props.enableAnimation && (props.config.animation?.enabled !== false);\r\n  \r\n  if (!animationEnabled) return {};\r\n  \r\n  const delay = (props.config.animation?.delay || 0.1) * index;\r\n  \r\n  return {\r\n    animation: `fadeIn 0.6s ease-out ${delay}s both`\r\n  };\r\n};\r\n\r\n// 从 API 获取数据的方法\r\nconst fetchMetrics = async (apiUrl) => {\r\n  try {\r\n    const response = await fetch(apiUrl);\r\n    const data = await response.json();\r\n    emit('metrics-loaded', data);\r\n    return data;\r\n  } catch (error) {\r\n    console.error('获取指标数据失败:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n// 更新单个指标数据\r\nconst updateMetric = (metricId, newData) => {\r\n  const index = metricsData.value.findIndex(m => m.id === metricId);\r\n  if (index !== -1) {\r\n    Object.assign(metricsData.value[index], newData);\r\n  }\r\n};\r\n\r\n// 添加新指标\r\nconst addMetric = (metric) => {\r\n  metricsData.value.push(metric);\r\n};\r\n\r\n// 移除指标\r\nconst removeMetric = (metricId) => {\r\n  const index = metricsData.value.findIndex(m => m.id === metricId);\r\n  if (index !== -1) {\r\n    metricsData.value.splice(index, 1);\r\n  }\r\n};\r\n\r\n// 暴露方法给父组件使用\r\ndefineExpose({\r\n  fetchMetrics,\r\n  updateMetric,\r\n  addMetric,\r\n  removeMetric\r\n});\r\n\r\nonMounted(() => {\r\n  // 如果配置中有 API URL，自动获取数据\r\n  if (props.config.apiUrl) {\r\n    fetchMetrics(props.config.apiUrl);\r\n  }\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.dynamic-metrics-container {\r\n  width: 100%;\r\n}\r\n\r\n.metrics-grid {\r\n  animation: fadeIn 0.6s ease-out;\r\n}\r\n\r\n/* 动画效果 */\r\n@keyframes fadeIn {\r\n  from {\r\n    opacity: 0;\r\n    transform: translateY(20px);\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    transform: translateY(0);\r\n  }\r\n}\r\n\r\n/* 响应式设计 */\r\n@media (max-width: 768px) {\r\n  .metrics-grid {\r\n    grid-template-columns: repeat(2, 1fr) !important;\r\n    gap: 12px !important;\r\n  }\r\n}\r\n\r\n@media (max-width: 480px) {\r\n  .metrics-grid {\r\n    grid-template-columns: 1fr !important;\r\n    gap: 10px !important;\r\n  }\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}