{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { ref, reactive, computed, watch, nextTick } from 'vue';\nimport { message } from 'ant-design-vue';\nimport { softwareAssetApi } from '@/api/softwareAsset';\nimport { supplierApi } from '@/api/supplier';\nimport { userApi } from '@/api/user';\n\n// Props\n\nexport default {\n  __name: 'SoftwareAssetForm',\n  props: {\n    visible: {\n      type: Boolean,\n      default: false\n    },\n    assetData: {\n      type: Object,\n      default: null\n    },\n    isEdit: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: ['update:visible', 'success'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n\n    // Emits\n    const emit = __emit;\n\n    // 响应式数据\n    const formRef = ref();\n    const activeTab = ref('basic');\n    const submitLoading = ref(false);\n    const userLoading = ref(false);\n    const supplierLoading = ref(false);\n    const userOptions = ref([]);\n    const supplierOptions = ref([]);\n    const supplierContacts = ref([]);\n    const deploymentServers = ref([{\n      hostname: '',\n      description: ''\n    }]);\n\n    // 表单数据\n    const formData = reactive({\n      software_name: '',\n      version: '',\n      software_type: '',\n      asset_owner: '',\n      supplier: null,\n      supplier_contact: '',\n      purchase_date: '',\n      asset_status: 'active',\n      license_type: '',\n      license_count: 1,\n      license_start_date: '',\n      license_end_date: '',\n      license_key: '',\n      installation_path: '',\n      config_path: '',\n      deployment_servers: [],\n      notes: ''\n    });\n\n    // 表单验证规则\n    const formRules = {\n      software_name: [{\n        required: true,\n        message: '请输入软件名称',\n        trigger: 'blur'\n      }],\n      version: [{\n        required: true,\n        message: '请输入软件版本',\n        trigger: 'blur'\n      }],\n      software_type: [{\n        required: true,\n        message: '请选择软件类型',\n        trigger: 'change'\n      }],\n      asset_owner: [{\n        required: true,\n        message: '请选择资产责任人',\n        trigger: 'change'\n      }],\n      purchase_date: [{\n        required: true,\n        message: '请选择采购日期',\n        trigger: 'change'\n      }],\n      license_type: [{\n        required: true,\n        message: '请选择许可证类型',\n        trigger: 'change'\n      }],\n      license_count: [{\n        required: true,\n        message: '请输入许可证数量',\n        trigger: 'blur'\n      }],\n      license_start_date: [{\n        required: true,\n        message: '请选择许可证开始日期',\n        trigger: 'change'\n      }],\n      license_end_date: [{\n        required: true,\n        message: '请选择许可证结束日期',\n        trigger: 'change'\n      }]\n    };\n\n    // 计算属性\n    const dialogVisible = computed({\n      get: () => props.visible,\n      set: value => emit('update:visible', value)\n    });\n\n    // 方法\n    const resetForm = () => {\n      Object.keys(formData).forEach(key => {\n        if (key === 'asset_status') {\n          formData[key] = 'active';\n        } else if (key === 'license_count') {\n          formData[key] = 1;\n        } else if (key === 'deployment_servers') {\n          formData[key] = [];\n        } else {\n          formData[key] = '';\n        }\n      });\n      deploymentServers.value = [{\n        hostname: '',\n        description: ''\n      }];\n      activeTab.value = 'basic';\n    };\n    const loadFormData = () => {\n      if (props.assetData && props.isEdit) {\n        Object.keys(formData).forEach(key => {\n          if (props.assetData[key] !== undefined) {\n            formData[key] = props.assetData[key];\n          }\n        });\n\n        // 处理部署服务器\n        if (props.assetData.deployment_servers && props.assetData.deployment_servers.length > 0) {\n          deploymentServers.value = [...props.assetData.deployment_servers];\n        } else {\n          deploymentServers.value = [{\n            hostname: '',\n            description: ''\n          }];\n        }\n      }\n    };\n    const searchUsers = async query => {\n      if (!query) return;\n      userLoading.value = true;\n      try {\n        const response = await userApi.search({\n          search: query\n        });\n        userOptions.value = response.data.results || [];\n      } catch (error) {\n        console.error('Search users error:', error);\n      } finally {\n        userLoading.value = false;\n      }\n    };\n    const searchSuppliers = async query => {\n      supplierLoading.value = true;\n      try {\n        const params = query ? {\n          search: query\n        } : {};\n        const response = await supplierApi.getSimpleList(params);\n        supplierOptions.value = response.data || [];\n      } catch (error) {\n        console.error('Search suppliers error:', error);\n      } finally {\n        supplierLoading.value = false;\n      }\n    };\n    const handleSupplierChange = async supplierId => {\n      if (!supplierId) {\n        supplierContacts.value = [];\n        formData.supplier_contact = '';\n        return;\n      }\n      try {\n        const response = await supplierApi.getContacts(supplierId);\n        supplierContacts.value = response.data || [];\n      } catch (error) {\n        console.error('Get supplier contacts error:', error);\n      }\n    };\n    const addServer = () => {\n      deploymentServers.value.push({\n        hostname: '',\n        description: ''\n      });\n    };\n    const removeServer = index => {\n      if (deploymentServers.value.length > 1) {\n        deploymentServers.value.splice(index, 1);\n      }\n    };\n    const handleSubmit = async () => {\n      try {\n        await formRef.value.validate();\n        submitLoading.value = true;\n\n        // 处理部署服务器\n        const servers = deploymentServers.value.filter(server => server.hostname && server.description);\n        formData.deployment_servers = servers;\n        if (props.isEdit) {\n          await softwareAssetApi.update(props.assetData.id, formData);\n          message.success('更新成功');\n        } else {\n          await softwareAssetApi.create(formData);\n          message.success('创建成功');\n        }\n        emit('success');\n      } catch (error) {\n        if (error.response?.data) {\n          const errorMsg = Object.values(error.response.data).flat().join(', ');\n          message.error(String(errorMsg));\n        } else {\n          message.error(props.isEdit ? '更新失败' : '创建失败');\n        }\n        console.error('Submit error:', error);\n      } finally {\n        submitLoading.value = false;\n      }\n    };\n    const handleClose = () => {\n      dialogVisible.value = false;\n      nextTick(() => {\n        formRef.value?.resetFields();\n        resetForm();\n      });\n    };\n\n    // 监听器\n    watch(() => props.visible, newVal => {\n      if (newVal) {\n        nextTick(() => {\n          if (props.isEdit) {\n            loadFormData();\n          } else {\n            resetForm();\n          }\n          searchSuppliers();\n        });\n      }\n    });\n    const __returned__ = {\n      props,\n      emit,\n      formRef,\n      activeTab,\n      submitLoading,\n      userLoading,\n      supplierLoading,\n      userOptions,\n      supplierOptions,\n      supplierContacts,\n      deploymentServers,\n      formData,\n      formRules,\n      dialogVisible,\n      resetForm,\n      loadFormData,\n      searchUsers,\n      searchSuppliers,\n      handleSupplierChange,\n      addServer,\n      removeServer,\n      handleSubmit,\n      handleClose,\n      ref,\n      reactive,\n      computed,\n      watch,\n      nextTick,\n      get message() {\n        return message;\n      },\n      get softwareAssetApi() {\n        return softwareAssetApi;\n      },\n      get supplierApi() {\n        return supplierApi;\n      },\n      get userApi() {\n        return userApi;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","reactive","computed","watch","nextTick","message","softwareAssetApi","supplierApi","userApi","props","__props","emit","__emit","formRef","activeTab","submitLoading","userLoading","supplierLoading","userOptions","supplierOptions","supplierContacts","deploymentServers","hostname","description","formData","software_name","version","software_type","asset_owner","supplier","supplier_contact","purchase_date","asset_status","license_type","license_count","license_start_date","license_end_date","license_key","installation_path","config_path","deployment_servers","notes","formRules","required","trigger","dialogVisible","get","visible","set","value","resetForm","Object","keys","forEach","key","loadFormData","assetData","isEdit","undefined","length","searchUsers","query","response","search","data","results","error","console","searchSuppliers","params","getSimpleList","handleSupplierChange","supplierId","getContacts","addServer","push","removeServer","index","splice","handleSubmit","validate","servers","filter","server","update","id","success","create","errorMsg","values","flat","join","String","handleClose","resetFields","newVal"],"sources":["E:/A_project/yuanchi/AIops/frontend/src/components/business/SoftwareAssetForm.vue"],"sourcesContent":["<template>\r\n  <a-modal\r\n    v-model:open=\"dialogVisible\"\r\n    :title=\"isEdit ? '编辑软件资产' : '新增软件资产'\"\r\n    width=\"800px\"\r\n    :before-close=\"handleClose\"\r\n  >\r\n    <a-form\r\n      ref=\"formRef\"\r\n      :model=\"formData\"\r\n      :rules=\"formRules\"\r\n      :label-col=\"{ span: 6 }\"\r\n      :wrapper-col=\"{ span: 18 }\"\r\n    >\r\n      <a-tabs v-model:activeKey=\"activeTab\">\r\n        <!-- 基本信息 -->\r\n        <a-tab-pane tab=\"基本信息\" key=\"basic\">\r\n          <a-row :gutter=\"20\">\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"软件名称\" name=\"software_name\">\r\n                <a-input v-model:value=\"formData.software_name\" placeholder=\"请输入软件名称\" />\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"软件版本\" name=\"version\">\r\n                <a-input v-model:value=\"formData.version\" placeholder=\"请输入软件版本\" />\r\n              </a-form-item>\r\n            </a-col>\r\n          </a-row>\r\n          \r\n          <a-row :gutter=\"20\">\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"软件类型\" name=\"software_type\">\r\n                <a-select v-model:value=\"formData.software_type\" placeholder=\"请选择软件类型\" style=\"width: 100%\">\r\n                  <a-select-option value=\"system\">系统软件</a-select-option>\r\n                  <a-select-option value=\"application\">应用软件</a-select-option>\r\n                  <a-select-option value=\"development\">开发工具</a-select-option>\r\n                  <a-select-option value=\"database\">数据库</a-select-option>\r\n                  <a-select-option value=\"security\">安全软件</a-select-option>\r\n                  <a-select-option value=\"other\">其他</a-select-option>\r\n                </a-select>\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"资产责任人\" name=\"asset_owner\">\r\n                <a-select\r\n                  v-model:value=\"formData.asset_owner\"\r\n                  placeholder=\"请选择资产责任人\"\r\n                  show-search\r\n                  :filter-option=\"false\"\r\n                  :loading=\"userLoading\"\r\n                  style=\"width: 100%\"\r\n                  @search=\"searchUsers\"\r\n                >\r\n                  <a-select-option\r\n                    v-for=\"user in userOptions\"\r\n                    :key=\"user.id\"\r\n                    :value=\"user.username\"\r\n                  >\r\n                    {{ user.username }}\r\n                  </a-select-option>\r\n                </a-select>\r\n              </a-form-item>\r\n            </a-col>\r\n          </a-row>\r\n          \r\n          <a-row :gutter=\"20\">\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"供应商\" name=\"supplier\">\r\n                <a-select\r\n                  v-model:value=\"formData.supplier\"\r\n                  placeholder=\"请选择供应商\"\r\n                  show-search\r\n                  :filter-option=\"false\"\r\n                  :loading=\"supplierLoading\"\r\n                  style=\"width: 100%\"\r\n                  @search=\"searchSuppliers\"\r\n                  @change=\"handleSupplierChange\"\r\n                >\r\n                  <a-select-option\r\n                    v-for=\"supplier in supplierOptions\"\r\n                    :key=\"supplier.id\"\r\n                    :value=\"supplier.id\"\r\n                  >\r\n                    {{ supplier.name }}\r\n                  </a-select-option>\r\n                </a-select>\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"供应商联系人\">\r\n                <a-select\r\n                  v-model:value=\"formData.supplier_contact\"\r\n                  placeholder=\"请选择联系人\"\r\n                  style=\"width: 100%\"\r\n                  :disabled=\"!formData.supplier\"\r\n                >\r\n                  <a-select-option\r\n                    v-for=\"contact in supplierContacts\"\r\n                    :key=\"contact.id\"\r\n                    :value=\"contact.name\"\r\n                  >\r\n                    {{ contact.name }}\r\n                  </a-select-option>\r\n                </a-select>\r\n              </a-form-item>\r\n            </a-col>\r\n          </a-row>\r\n          \r\n          <a-row :gutter=\"20\">\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"采购日期\" name=\"purchase_date\">\r\n                <a-date-picker\r\n                  v-model:value=\"formData.purchase_date\"\r\n                  placeholder=\"请选择采购日期\"\r\n                  style=\"width: 100%\"\r\n                  format=\"YYYY-MM-DD\"\r\n                  value-format=\"YYYY-MM-DD\"\r\n                />\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :span=\"12\" v-if=\"isEdit\">\r\n              <a-form-item label=\"资产状态\" name=\"asset_status\">\r\n                <a-select v-model:value=\"formData.asset_status\" placeholder=\"请选择资产状态\" style=\"width: 100%\">\r\n                  <a-select-option value=\"active\">激活</a-select-option>\r\n                  <a-select-option value=\"inactive\">未激活</a-select-option>\r\n                  <a-select-option value=\"expired\">过期</a-select-option>\r\n                  <a-select-option value=\"retired\">退役</a-select-option>\r\n                </a-select>\r\n              </a-form-item>\r\n            </a-col>\r\n          </a-row>\r\n        </a-tab-pane>\r\n        \r\n        <!-- 许可证信息 -->\r\n        <a-tab-pane tab=\"许可证信息\" key=\"license\">\r\n          <a-row :gutter=\"20\">\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"许可证类型\" name=\"license_type\">\r\n                <a-select v-model:value=\"formData.license_type\" placeholder=\"请选择许可证类型\" style=\"width: 100%\">\r\n                  <a-select-option value=\"perpetual\">永久许可</a-select-option>\r\n                  <a-select-option value=\"subscription\">订阅许可</a-select-option>\r\n                  <a-select-option value=\"trial\">试用许可</a-select-option>\r\n                  <a-select-option value=\"open_source\">开源许可</a-select-option>\r\n                </a-select>\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"许可证数量\" name=\"license_count\">\r\n                <a-input-number\r\n                  v-model:value=\"formData.license_count\"\r\n                  placeholder=\"请输入许可证数量\"\r\n                  style=\"width: 100%\"\r\n                  :min=\"1\"\r\n                />\r\n              </a-form-item>\r\n            </a-col>\r\n          </a-row>\r\n          \r\n          <a-row :gutter=\"20\">\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"许可证开始日期\" name=\"license_start_date\">\r\n                <a-date-picker\r\n                  v-model:value=\"formData.license_start_date\"\r\n                  placeholder=\"请选择许可证开始日期\"\r\n                  style=\"width: 100%\"\r\n                  format=\"YYYY-MM-DD\"\r\n                  value-format=\"YYYY-MM-DD\"\r\n                />\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"许可证结束日期\" name=\"license_end_date\">\r\n                <a-date-picker\r\n                  v-model:value=\"formData.license_end_date\"\r\n                  placeholder=\"请选择许可证结束日期\"\r\n                  style=\"width: 100%\"\r\n                  format=\"YYYY-MM-DD\"\r\n                  value-format=\"YYYY-MM-DD\"\r\n                />\r\n              </a-form-item>\r\n            </a-col>\r\n          </a-row>\r\n          \r\n          <a-row :gutter=\"20\">\r\n            <a-col :span=\"24\">\r\n              <a-form-item label=\"许可证密钥\">\r\n                <a-textarea\r\n                  v-model:value=\"formData.license_key\"\r\n                  placeholder=\"请输入许可证密钥\"\r\n                  :rows=\"3\"\r\n                />\r\n              </a-form-item>\r\n            </a-col>\r\n          </a-row>\r\n        </a-tab-pane>\r\n        \r\n        <!-- 部署信息 -->\r\n        <a-tab-pane tab=\"部署信息\" key=\"deployment\">\r\n          <a-row :gutter=\"20\">\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"安装路径\">\r\n                <a-input v-model:value=\"formData.installation_path\" placeholder=\"请输入安装路径\" />\r\n              </a-form-item>\r\n            </a-col>\r\n            <a-col :span=\"12\">\r\n              <a-form-item label=\"配置文件路径\">\r\n                <a-input v-model:value=\"formData.config_path\" placeholder=\"请输入配置文件路径\" />\r\n              </a-form-item>\r\n            </a-col>\r\n          </a-row>\r\n          \r\n          <a-row :gutter=\"20\">\r\n            <a-col :span=\"24\">\r\n              <a-form-item label=\"部署服务器\">\r\n                <div class=\"server-container\">\r\n                  <div v-for=\"(server, index) in deploymentServers\" :key=\"index\" class=\"server-item\">\r\n                    <a-input\r\n                      v-model:value=\"server.hostname\"\r\n                      placeholder=\"服务器主机名或IP\"\r\n                      style=\"width: 200px; margin-right: 10px\"\r\n                    />\r\n                    <a-input\r\n                      v-model:value=\"server.description\"\r\n                      placeholder=\"描述\"\r\n                      style=\"width: 200px; margin-right: 10px\"\r\n                    />\r\n                    <a-button type=\"primary\" danger size=\"small\" @click=\"removeServer(index)\">\r\n                      删除\r\n                    </a-button>\r\n                  </div>\r\n                  <a-button type=\"primary\" size=\"small\" @click=\"addServer\">\r\n                    添加服务器\r\n                  </a-button>\r\n                </div>\r\n              </a-form-item>\r\n            </a-col>\r\n          </a-row>\r\n          \r\n          <a-row :gutter=\"20\">\r\n            <a-col :span=\"24\">\r\n              <a-form-item label=\"备注\">\r\n                <a-textarea\r\n                  v-model:value=\"formData.notes\"\r\n                  placeholder=\"请输入备注信息\"\r\n                  :rows=\"3\"\r\n                />\r\n              </a-form-item>\r\n            </a-col>\r\n          </a-row>\r\n        </a-tab-pane>\r\n      </a-tabs>\r\n    </a-form>\r\n    \r\n    <template #footer>\r\n      <div class=\"dialog-footer\">\r\n        <a-button @click=\"handleClose\">取消</a-button>\r\n        <a-button type=\"primary\" @click=\"handleSubmit\" :loading=\"submitLoading\">\r\n          {{ isEdit ? '更新' : '创建' }}\r\n        </a-button>\r\n      </div>\r\n    </template>\r\n  </a-modal>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, computed, watch, nextTick } from 'vue'\r\nimport { message } from 'ant-design-vue'\r\nimport { softwareAssetApi } from '@/api/softwareAsset'\r\nimport { supplierApi } from '@/api/supplier'\r\nimport { userApi } from '@/api/user'\r\n\r\n// Props\r\nconst props = defineProps({\r\n  visible: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  assetData: {\r\n    type: Object,\r\n    default: null\r\n  },\r\n  isEdit: {\r\n    type: Boolean,\r\n    default: false\r\n  }\r\n})\r\n\r\n// Emits\r\nconst emit = defineEmits(['update:visible', 'success'])\r\n\r\n// 响应式数据\r\nconst formRef = ref()\r\nconst activeTab = ref('basic')\r\nconst submitLoading = ref(false)\r\nconst userLoading = ref(false)\r\nconst supplierLoading = ref(false)\r\nconst userOptions = ref([])\r\nconst supplierOptions = ref([])\r\nconst supplierContacts = ref([])\r\nconst deploymentServers = ref([{ hostname: '', description: '' }])\r\n\r\n// 表单数据\r\nconst formData = reactive({\r\n  software_name: '',\r\n  version: '',\r\n  software_type: '',\r\n  asset_owner: '',\r\n  supplier: null,\r\n  supplier_contact: '',\r\n  purchase_date: '',\r\n  asset_status: 'active',\r\n  license_type: '',\r\n  license_count: 1,\r\n  license_start_date: '',\r\n  license_end_date: '',\r\n  license_key: '',\r\n  installation_path: '',\r\n  config_path: '',\r\n  deployment_servers: [],\r\n  notes: ''\r\n})\r\n\r\n// 表单验证规则\r\nconst formRules = {\r\n  software_name: [\r\n    { required: true, message: '请输入软件名称', trigger: 'blur' }\r\n  ],\r\n  version: [\r\n    { required: true, message: '请输入软件版本', trigger: 'blur' }\r\n  ],\r\n  software_type: [\r\n    { required: true, message: '请选择软件类型', trigger: 'change' }\r\n  ],\r\n  asset_owner: [\r\n    { required: true, message: '请选择资产责任人', trigger: 'change' }\r\n  ],\r\n  purchase_date: [\r\n    { required: true, message: '请选择采购日期', trigger: 'change' }\r\n  ],\r\n  license_type: [\r\n    { required: true, message: '请选择许可证类型', trigger: 'change' }\r\n  ],\r\n  license_count: [\r\n    { required: true, message: '请输入许可证数量', trigger: 'blur' }\r\n  ],\r\n  license_start_date: [\r\n    { required: true, message: '请选择许可证开始日期', trigger: 'change' }\r\n  ],\r\n  license_end_date: [\r\n    { required: true, message: '请选择许可证结束日期', trigger: 'change' }\r\n  ]\r\n}\r\n\r\n// 计算属性\r\nconst dialogVisible = computed({\r\n  get: () => props.visible,\r\n  set: (value) => emit('update:visible', value)\r\n})\r\n\r\n// 方法\r\nconst resetForm = () => {\r\n  Object.keys(formData).forEach(key => {\r\n    if (key === 'asset_status') {\r\n      formData[key] = 'active'\r\n    } else if (key === 'license_count') {\r\n      formData[key] = 1\r\n    } else if (key === 'deployment_servers') {\r\n      formData[key] = []\r\n    } else {\r\n      formData[key] = ''\r\n    }\r\n  })\r\n  deploymentServers.value = [{ hostname: '', description: '' }]\r\n  activeTab.value = 'basic'\r\n}\r\n\r\nconst loadFormData = () => {\r\n  if (props.assetData && props.isEdit) {\r\n    Object.keys(formData).forEach(key => {\r\n      if (props.assetData[key] !== undefined) {\r\n        formData[key] = props.assetData[key]\r\n      }\r\n    })\r\n    \r\n    // 处理部署服务器\r\n    if (props.assetData.deployment_servers && props.assetData.deployment_servers.length > 0) {\r\n      deploymentServers.value = [...props.assetData.deployment_servers]\r\n    } else {\r\n      deploymentServers.value = [{ hostname: '', description: '' }]\r\n    }\r\n  }\r\n}\r\n\r\nconst searchUsers = async (query) => {\r\n  if (!query) return\r\n  \r\n  userLoading.value = true\r\n  try {\r\n    const response = await userApi.search({ search: query })\r\n    userOptions.value = response.data.results || []\r\n  } catch (error) {\r\n    console.error('Search users error:', error)\r\n  } finally {\r\n    userLoading.value = false\r\n  }\r\n}\r\n\r\nconst searchSuppliers = async (query) => {\r\n  supplierLoading.value = true\r\n  try {\r\n    const params = query ? { search: query } : {}\r\n    const response = await supplierApi.getSimpleList(params)\r\n    supplierOptions.value = response.data || []\r\n  } catch (error) {\r\n    console.error('Search suppliers error:', error)\r\n  } finally {\r\n    supplierLoading.value = false\r\n  }\r\n}\r\n\r\nconst handleSupplierChange = async (supplierId) => {\r\n  if (!supplierId) {\r\n    supplierContacts.value = []\r\n    formData.supplier_contact = ''\r\n    return\r\n  }\r\n  \r\n  try {\r\n    const response = await supplierApi.getContacts(supplierId)\r\n    supplierContacts.value = response.data || []\r\n  } catch (error) {\r\n    console.error('Get supplier contacts error:', error)\r\n  }\r\n}\r\n\r\nconst addServer = () => {\r\n  deploymentServers.value.push({ hostname: '', description: '' })\r\n}\r\n\r\nconst removeServer = (index) => {\r\n  if (deploymentServers.value.length > 1) {\r\n    deploymentServers.value.splice(index, 1)\r\n  }\r\n}\r\n\r\nconst handleSubmit = async () => {\r\n  try {\r\n    await formRef.value.validate()\r\n    \r\n    submitLoading.value = true\r\n    \r\n    // 处理部署服务器\r\n    const servers = deploymentServers.value.filter(server => server.hostname && server.description)\r\n    formData.deployment_servers = servers\r\n    \r\n    if (props.isEdit) {\r\n      await softwareAssetApi.update(props.assetData.id, formData)\r\n      message.success('更新成功')\r\n    } else {\r\n      await softwareAssetApi.create(formData)\r\n      message.success('创建成功')\r\n    }\r\n    \r\n    emit('success')\r\n  } catch (error) {\r\n    if (error.response?.data) {\r\n      const errorMsg = Object.values(error.response.data).flat().join(', ')\r\n      message.error(String(errorMsg))\r\n    } else {\r\n      message.error(props.isEdit ? '更新失败' : '创建失败')\r\n    }\r\n    console.error('Submit error:', error)\r\n  } finally {\r\n    submitLoading.value = false\r\n  }\r\n}\r\n\r\nconst handleClose = () => {\r\n  dialogVisible.value = false\r\n  nextTick(() => {\r\n    formRef.value?.resetFields()\r\n    resetForm()\r\n  })\r\n}\r\n\r\n// 监听器\r\nwatch(\r\n  () => props.visible,\r\n  (newVal) => {\r\n    if (newVal) {\r\n      nextTick(() => {\r\n        if (props.isEdit) {\r\n          loadFormData()\r\n        } else {\r\n          resetForm()\r\n        }\r\n        searchSuppliers()\r\n      })\r\n    }\r\n  }\r\n)\r\n</script>\r\n\r\n<style scoped>\r\n.server-container {\r\n  border: 1px solid #dcdfe6;\r\n  border-radius: 4px;\r\n  padding: 15px;\r\n  background-color: #fafafa;\r\n}\r\n\r\n.server-item {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.server-item:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.dialog-footer {\r\n  text-align: right;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}