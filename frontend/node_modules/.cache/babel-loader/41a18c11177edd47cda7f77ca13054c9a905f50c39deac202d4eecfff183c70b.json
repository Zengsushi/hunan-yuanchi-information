{"ast":null,"code":"import { ref, reactive, onMounted, computed } from 'vue';\nimport { message } from 'ant-design-vue';\nimport { BankOutlined, ExportOutlined, PlusOutlined, SearchOutlined, ReloadOutlined, FolderOutlined, FileOutlined, EyeOutlined, EditOutlined, DeleteOutlined } from '@ant-design/icons-vue';\nimport { getDepartments, getDepartmentTree, createDepartment, updateDepartment, deleteDepartment, getDepartmentStatistics } from '@/api/organization';\nimport { userAPI } from '@/api/users';\n\n// 响应式数据\n\nexport default {\n  __name: 'AdminDepartments',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const loading = ref(false);\n    const searchText = ref('');\n    const statusFilter = ref('');\n    const levelFilter = ref('');\n    const modalVisible = ref(false);\n    const detailModalVisible = ref(false);\n    const isEdit = ref(false);\n    const selectedDepartment = ref(null);\n    const formRef = ref();\n\n    // 表单数据\n    const formData = reactive({\n      name: '',\n      code: '',\n      parent: null,\n      manager: null,\n      sort_order: 0,\n      status: 'active',\n      description: ''\n    });\n\n    // 表单验证规则\n    const formRules = {\n      name: [{\n        required: true,\n        message: '请输入部门名称',\n        trigger: 'blur'\n      }],\n      code: [{\n        required: true,\n        message: '请输入部门编码',\n        trigger: 'blur'\n      }],\n      status: [{\n        required: true,\n        message: '请选择状态',\n        trigger: 'change'\n      }]\n    };\n\n    // 数据\n    const departmentList = ref([]);\n    const userList = ref([]);\n    const departmentTreeDataRef = ref([]);\n\n    // 表格列定义\n    const columns = [{\n      title: '部门名称',\n      dataIndex: 'name',\n      key: 'name'\n    }, {\n      title: '部门编码',\n      dataIndex: 'code',\n      key: 'code'\n    }, {\n      title: '上级部门',\n      dataIndex: 'parent_name',\n      key: 'parent_name'\n    }, {\n      title: '负责人',\n      dataIndex: 'manager',\n      key: 'manager',\n      width: 100\n    }, {\n      title: '状态',\n      key: 'status',\n      width: 80\n    }, {\n      title: '操作',\n      key: 'action',\n      width: 200,\n      fixed: 'right'\n    }];\n\n    // 分页配置\n    const pagination = reactive({\n      current: 1,\n      pageSize: 10,\n      total: 0,\n      showSizeChanger: true,\n      showQuickJumper: true,\n      showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条`\n    });\n\n    // 计算属性\n    const modalTitle = computed(() => {\n      return isEdit.value ? '编辑部门' : '新建部门';\n    });\n\n    // 构建树形数据\n    const departmentTreeData = computed(() => {\n      // 直接返回从API获取的树形数据\n      return departmentTreeDataRef.value;\n    });\n    const departmentOptions = computed(() => {\n      // 构建部门选择器数据\n      const buildOptions = departments => {\n        if (!Array.isArray(departments)) {\n          return [];\n        }\n        return departments.map(dept => ({\n          title: dept.name,\n          value: dept.id,\n          key: dept.id,\n          children: dept.children && dept.children.length > 0 ? buildOptions(dept.children) : []\n        }));\n      };\n      return buildOptions(departmentTreeData.value);\n    });\n\n    // 方法\n\n    const handleSearch = () => {\n      loadDepartments();\n    };\n    const handleSearchChange = () => {\n      if (!searchText.value) {\n        loadDepartments();\n      }\n    };\n    const handleFilterChange = () => {\n      loadDepartments();\n    };\n    const resetFilters = () => {\n      searchText.value = '';\n      statusFilter.value = '';\n      levelFilter.value = '';\n      loadDepartments();\n    };\n    const handleTableChange = (pag, filters, sorter) => {\n      // 树形表格不需要分页处理\n      loadDepartments();\n    };\n    const loadDepartments = async () => {\n      loading.value = true;\n      try {\n        // 获取树形结构数据\n        const response = await getDepartmentTree();\n        if (response.status == 200) {\n          const results = response.data || [];\n          console.log('部门树形数据:', results);\n          // 直接使用树形数据\n          departmentTreeDataRef.value = results;\n          // 同时保存扁平化数据用于其他功能\n          departmentList.value = flattenTreeData(results);\n        }\n      } catch (error) {\n        console.error('加载部门列表失败:', error);\n        message.error('加载部门列表失败');\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 将树形数据扁平化\n    const flattenTreeData = treeData => {\n      const result = [];\n      const flatten = (nodes, level = 1) => {\n        nodes.forEach(node => {\n          result.push({\n            ...node,\n            level: level\n          });\n          if (node.children && node.children.length > 0) {\n            flatten(node.children, level + 1);\n          }\n        });\n      };\n      flatten(treeData);\n      return result;\n    };\n    const showAddModal = () => {\n      isEdit.value = false;\n      resetForm();\n      modalVisible.value = true;\n    };\n    const addSubDepartment = record => {\n      isEdit.value = false;\n      resetForm();\n      formData.parent = record.id;\n      modalVisible.value = true;\n    };\n    const editDepartment = record => {\n      isEdit.value = true;\n      Object.assign(formData, {\n        id: record.id,\n        name: record.name,\n        code: record.code,\n        parent: record.parent,\n        manager: record.manager,\n        sort_order: record.sort_order,\n        status: record.status,\n        description: record.description\n      });\n      modalVisible.value = true;\n    };\n    const viewDepartment = record => {\n      selectedDepartment.value = record;\n      detailModalVisible.value = true;\n    };\n    const handleDeleteDepartment = async record => {\n      try {\n        await deleteDepartment(record.id);\n        message.success('删除成功');\n        loadDepartments();\n      } catch (error) {\n        console.error('删除部门失败:', error);\n        message.error('删除失败');\n      }\n    };\n    const handleModalOk = async () => {\n      try {\n        await formRef.value.validate();\n\n        // 准备提交数据，将parent转换为parent_id\n        const submitData = {\n          ...formData\n        };\n        if (submitData.parent) {\n          submitData.parent_id = submitData.parent;\n          delete submitData.parent;\n        }\n        if (isEdit.value) {\n          await updateDepartment(submitData.id, submitData);\n          message.success('更新成功');\n        } else {\n          await createDepartment(submitData);\n          message.success('创建成功');\n        }\n        modalVisible.value = false;\n        loadDepartments();\n        loadDepartmentTree();\n      } catch (error) {\n        console.error('保存部门失败:', error);\n\n        // 处理表单验证错误\n        if (error.errorFields) {\n          message.error('请检查表单输入');\n          return;\n        }\n\n        // 处理API返回的错误\n        if (error.response && error.response.data) {\n          const errorData = error.response.data;\n\n          // 处理字段特定错误\n          if (errorData.code && Array.isArray(errorData.code)) {\n            message.error(`部门编码错误: ${errorData.code[0]}`);\n            return;\n          }\n          if (errorData.name && Array.isArray(errorData.name)) {\n            message.error(`部门名称错误: ${errorData.name[0]}`);\n            return;\n          }\n\n          // 处理其他字段错误\n          const firstErrorField = Object.keys(errorData)[0];\n          if (firstErrorField && Array.isArray(errorData[firstErrorField])) {\n            message.error(`${firstErrorField}: ${errorData[firstErrorField][0]}`);\n            return;\n          }\n\n          // 处理通用错误消息\n          if (errorData.detail) {\n            message.error(errorData.detail);\n            return;\n          }\n          if (errorData.message) {\n            message.error(errorData.message);\n            return;\n          }\n        }\n\n        // 默认错误消息\n        message.error(isEdit.value ? '更新失败' : '创建失败');\n      }\n    };\n    const handleModalCancel = () => {\n      modalVisible.value = false;\n      resetForm();\n    };\n    const resetForm = () => {\n      Object.assign(formData, {\n        name: '',\n        code: '',\n        parent: null,\n        manager: null,\n        sort_order: 0,\n        status: 'active',\n        description: ''\n      });\n      if (formRef.value) {\n        formRef.value.resetFields();\n      }\n    };\n    const exportDepartments = () => {\n      // 导出功能实现\n      message.info('导出功能开发中...');\n    };\n    const filterOption = (input, option) => {\n      return option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0;\n    };\n    const getCurrentCategoryName = () => {\n      return '部门管理';\n    };\n    const refreshData = () => {\n      loadDepartments();\n    };\n\n    // 加载部门树形数据\n    const loadDepartmentTree = async () => {\n      try {\n        const response = await getDepartmentTree();\n        const treeData = response.data || response || [];\n        departmentTreeData.value = Array.isArray(treeData) ? treeData : [];\n      } catch (error) {\n        console.error('加载部门树失败:', error);\n      }\n    };\n\n    // 加载用户列表\n    const loadUsers = async () => {\n      try {\n        const response = await userAPI.getUserList();\n        const users = response.data?.results || response.data?.data || [];\n        userList.value = Array.isArray(users) ? users : [];\n      } catch (error) {\n        console.error('加载用户列表失败:', error);\n      }\n    };\n\n    // 生命周期\n    onMounted(() => {\n      loadDepartments();\n      loadDepartmentTree();\n      loadUsers();\n    });\n    const __returned__ = {\n      loading,\n      searchText,\n      statusFilter,\n      levelFilter,\n      modalVisible,\n      detailModalVisible,\n      isEdit,\n      selectedDepartment,\n      formRef,\n      formData,\n      formRules,\n      departmentList,\n      userList,\n      departmentTreeDataRef,\n      columns,\n      pagination,\n      modalTitle,\n      departmentTreeData,\n      departmentOptions,\n      handleSearch,\n      handleSearchChange,\n      handleFilterChange,\n      resetFilters,\n      handleTableChange,\n      loadDepartments,\n      flattenTreeData,\n      showAddModal,\n      addSubDepartment,\n      editDepartment,\n      viewDepartment,\n      handleDeleteDepartment,\n      handleModalOk,\n      handleModalCancel,\n      resetForm,\n      exportDepartments,\n      filterOption,\n      getCurrentCategoryName,\n      refreshData,\n      loadDepartmentTree,\n      loadUsers,\n      ref,\n      reactive,\n      onMounted,\n      computed,\n      get message() {\n        return message;\n      },\n      get BankOutlined() {\n        return BankOutlined;\n      },\n      get ExportOutlined() {\n        return ExportOutlined;\n      },\n      get PlusOutlined() {\n        return PlusOutlined;\n      },\n      get SearchOutlined() {\n        return SearchOutlined;\n      },\n      get ReloadOutlined() {\n        return ReloadOutlined;\n      },\n      get FolderOutlined() {\n        return FolderOutlined;\n      },\n      get FileOutlined() {\n        return FileOutlined;\n      },\n      get EyeOutlined() {\n        return EyeOutlined;\n      },\n      get EditOutlined() {\n        return EditOutlined;\n      },\n      get DeleteOutlined() {\n        return DeleteOutlined;\n      },\n      get getDepartments() {\n        return getDepartments;\n      },\n      get getDepartmentTree() {\n        return getDepartmentTree;\n      },\n      get createDepartment() {\n        return createDepartment;\n      },\n      get updateDepartment() {\n        return updateDepartment;\n      },\n      get deleteDepartment() {\n        return deleteDepartment;\n      },\n      get getDepartmentStatistics() {\n        return getDepartmentStatistics;\n      },\n      get userAPI() {\n        return userAPI;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","reactive","onMounted","computed","message","BankOutlined","ExportOutlined","PlusOutlined","SearchOutlined","ReloadOutlined","FolderOutlined","FileOutlined","EyeOutlined","EditOutlined","DeleteOutlined","getDepartments","getDepartmentTree","createDepartment","updateDepartment","deleteDepartment","getDepartmentStatistics","userAPI","loading","searchText","statusFilter","levelFilter","modalVisible","detailModalVisible","isEdit","selectedDepartment","formRef","formData","name","code","parent","manager","sort_order","status","description","formRules","required","trigger","departmentList","userList","departmentTreeDataRef","columns","title","dataIndex","key","width","fixed","pagination","current","pageSize","total","showSizeChanger","showQuickJumper","showTotal","range","modalTitle","value","departmentTreeData","departmentOptions","buildOptions","departments","Array","isArray","map","dept","id","children","length","handleSearch","loadDepartments","handleSearchChange","handleFilterChange","resetFilters","handleTableChange","pag","filters","sorter","response","results","data","console","log","flattenTreeData","error","treeData","result","flatten","nodes","level","forEach","node","push","showAddModal","resetForm","addSubDepartment","record","editDepartment","Object","assign","viewDepartment","handleDeleteDepartment","success","handleModalOk","validate","submitData","parent_id","loadDepartmentTree","errorFields","errorData","firstErrorField","keys","detail","handleModalCancel","resetFields","exportDepartments","info","filterOption","input","option","toLowerCase","indexOf","getCurrentCategoryName","refreshData","loadUsers","getUserList","users"],"sources":["E:/A_project/yuanchi/AIops/frontend/src/views/admin/AdminDepartments.vue"],"sourcesContent":["<template>\r\n  <div class=\"admin-departments admin-page\">\r\n    <!-- 页面标题区域 -->\r\n    <div class=\"page-header\">\r\n      <div class=\"header-content\">\r\n        <h1 class=\"page-title\">\r\n          <BankOutlined />\r\n          部门管理\r\n        </h1>\r\n        <p class=\"page-description\">管理组织架构中的部门信息</p>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        <a-space>\r\n          <a-tooltip title=\"导出部门列表为Excel文件\" placement=\"bottom\">\r\n            <a-button @click=\"exportDepartments\">\r\n              <ExportOutlined />\r\n              导出部门\r\n            </a-button>\r\n          </a-tooltip>\r\n          <a-tooltip title=\"创建新的部门\" placement=\"bottom\">\r\n            <a-button type=\"primary\" @click=\"showAddModal\">\r\n              <PlusOutlined />\r\n              新建部门\r\n            </a-button>\r\n          </a-tooltip>\r\n        </a-space>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 部门管理布局 -->\r\n    <div class=\"departments-layout admin-layout\">\r\n      <!-- 内容区域 -->\r\n      <div class=\"departments-content admin-content full-width\">\r\n        <a-card>\r\n          <template #title>\r\n            {{ getCurrentCategoryName() }}\r\n          </template>\r\n          <template #extra>\r\n             <a-space>\r\n               <a-input-search\r\n                 v-model:value=\"searchText\"\r\n                 placeholder=\"搜索部门...\"\r\n                 style=\"width: 200px\"\r\n                 @search=\"handleSearch\"\r\n                 @change=\"handleSearch\"\r\n               />\r\n               <a-select\r\n                 v-model:value=\"statusFilter\"\r\n                 placeholder=\"状态筛选\"\r\n                 style=\"width: 120px\"\r\n                 @change=\"handleFilterChange\"\r\n               >\r\n                 <a-select-option value=\"\">全部状态</a-select-option>\r\n                 <a-select-option value=\"active\">启用</a-select-option>\r\n                 <a-select-option value=\"inactive\">禁用</a-select-option>\r\n               </a-select>\r\n               <a-tooltip title=\"刷新部门列表数据\" placement=\"bottom\">\r\n                 <a-button @click=\"refreshData\">\r\n                   <ReloadOutlined />\r\n                 </a-button>\r\n               </a-tooltip>\r\n             </a-space>\r\n           </template>\r\n\r\n          <!-- 部门表格 -->\r\n          <a-table\r\n            :columns=\"columns\"\r\n            :data-source=\"departmentTreeData\"\r\n            :loading=\"loading\"\r\n            :pagination=\"false\"\r\n            row-key=\"id\"\r\n            :tree-props=\"{ children: 'children', hasChildren: 'hasChildren' }\"\r\n            :default-expand-all=\"false\"\r\n            :expand-row-by-click=\"false\"\r\n            @change=\"handleTableChange\"\r\n          >\r\n            <template #bodyCell=\"{ column, record }\">\r\n              <template v-if=\"column.key === 'name'\">\r\n                <div class=\"department-name\">\r\n                  <FolderOutlined v-if=\"record.children && record.children.length > 0\" class=\"folder-icon\" />\r\n                  <FileOutlined v-else class=\"file-icon\" />\r\n                  <span class=\"name-text\">{{ record.name }}</span>\r\n                </div>\r\n              </template>\r\n              <template v-else-if=\"column.key === 'manager'\">\r\n                <div class=\"manager-info\" v-if=\"record.manager\">\r\n                  <span class=\"manager-name\">{{ record.manager }}</span>\r\n                </div>\r\n                <span v-else class=\"no-manager\">未设置</span>\r\n              </template>\r\n              <template v-else-if=\"column.key === 'status'\">\r\n                <a-tag :color=\"record.status === 'active' ? 'green' : 'red'\">\r\n                  {{ record.status === 'active' ? '启用' : '禁用' }}\r\n                </a-tag>\r\n              </template>\r\n              <template v-else-if=\"column.key === 'action'\">\r\n                <a-space>\r\n                  <a-tooltip title=\"查看详情\">\r\n                    <a-button type=\"text\" size=\"small\" @click=\"viewDepartment(record)\">\r\n                      <EyeOutlined />\r\n                    </a-button>\r\n                  </a-tooltip>\r\n                  <a-tooltip title=\"编辑部门\">\r\n                    <a-button type=\"text\" size=\"small\" @click=\"editDepartment(record)\">\r\n                      <EditOutlined />\r\n                    </a-button>\r\n                  </a-tooltip>\r\n                  <a-tooltip title=\"添加子部门\">\r\n                    <a-button type=\"text\" size=\"small\" @click=\"addSubDepartment(record)\">\r\n                      <PlusOutlined />\r\n                    </a-button>\r\n                  </a-tooltip>\r\n                  <a-popconfirm\r\n                    title=\"确定要删除这个部门吗？\"\r\n                    @confirm=\"handleDeleteDepartment(record)\"\r\n                  >\r\n                    <a-tooltip title=\"删除部门\">\r\n                      <a-button type=\"text\" size=\"small\" danger>\r\n                        <DeleteOutlined />\r\n                      </a-button>\r\n                    </a-tooltip>\r\n                  </a-popconfirm>\r\n                </a-space>\r\n              </template>\r\n            </template>\r\n          </a-table>\r\n        </a-card>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 新建/编辑部门弹窗 -->\r\n    <a-modal\r\n      v-model:open=\"modalVisible\"\r\n      :title=\"modalTitle\"\r\n      :width=\"600\"\r\n      @ok=\"handleModalOk\"\r\n      @cancel=\"handleModalCancel\"\r\n    >\r\n      <a-form\r\n        ref=\"formRef\"\r\n        :model=\"formData\"\r\n        :rules=\"formRules\"\r\n        layout=\"vertical\"\r\n      >\r\n        <a-row :gutter=\"16\">\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"部门名称\" name=\"name\">\r\n              <a-input v-model:value=\"formData.name\" placeholder=\"请输入部门名称\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"部门编码\" name=\"code\">\r\n              <a-input v-model:value=\"formData.code\" placeholder=\"请输入部门编码\" />\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n        \r\n        <a-row :gutter=\"16\">\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"上级部门\" name=\"parent\">\r\n              <a-tree-select\r\n                v-model:value=\"formData.parent\"\r\n                :tree-data=\"departmentOptions\"\r\n                placeholder=\"请选择上级部门\"\r\n                allow-clear\r\n                tree-default-expand-all\r\n              />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"部门负责人\" name=\"manager\">\r\n              <a-select\r\n                v-model:value=\"formData.manager\"\r\n                placeholder=\"请选择部门负责人\"\r\n                allow-clear\r\n                show-search\r\n                :filter-option=\"filterOption\"\r\n              >\r\n                <a-select-option v-for=\"user in userList\" :key=\"user.id\" :value=\"user.id\">\r\n                  {{ user.username }} - {{ user.first_name }} {{ user.last_name }}\r\n                </a-select-option>\r\n              </a-select>\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n\r\n        <a-row :gutter=\"16\">\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"状态\" name=\"status\">\r\n              <a-select v-model:value=\"formData.status\" placeholder=\"请选择状态\">\r\n                <a-select-option value=\"active\">启用</a-select-option>\r\n                <a-select-option value=\"inactive\">禁用</a-select-option>\r\n              </a-select>\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n\r\n        <a-form-item label=\"部门描述\" name=\"description\">\r\n          <a-textarea\r\n            v-model:value=\"formData.description\"\r\n            placeholder=\"请输入部门描述\"\r\n            :rows=\"3\"\r\n          />\r\n        </a-form-item>\r\n      </a-form>\r\n    </a-modal>\r\n\r\n    <!-- 部门详情弹窗 -->\r\n    <a-modal\r\n      v-model:open=\"detailModalVisible\"\r\n      title=\"部门详情\"\r\n      :width=\"800\"\r\n      :footer=\"null\"\r\n    >\r\n      <div v-if=\"selectedDepartment\" class=\"department-detail\">\r\n        <a-descriptions :column=\"2\" bordered>\r\n          <a-descriptions-item label=\"部门名称\">\r\n            {{ selectedDepartment.name }}\r\n          </a-descriptions-item>\r\n          <a-descriptions-item label=\"部门编码\">\r\n            {{ selectedDepartment.code }}\r\n          </a-descriptions-item>\r\n          <a-descriptions-item label=\"上级部门\">\r\n            {{ selectedDepartment.parent_name || '无' }}\r\n          </a-descriptions-item>\r\n          <a-descriptions-item label=\"部门负责人\">\r\n            {{ selectedDepartment.manager || '未设置' }}\r\n          </a-descriptions-item>\r\n          <a-descriptions-item label=\"状态\">\r\n            <a-tag :color=\"selectedDepartment.status === 'active' ? 'green' : 'red'\">\r\n              {{ selectedDepartment.status === 'active' ? '启用' : '禁用' }}\r\n            </a-tag>\r\n          </a-descriptions-item>\r\n          <a-descriptions-item label=\"创建时间\" :span=\"2\">\r\n            {{ selectedDepartment.created_at }}\r\n          </a-descriptions-item>\r\n          <a-descriptions-item label=\"部门描述\" :span=\"2\">\r\n            {{ selectedDepartment.description || '无' }}\r\n          </a-descriptions-item>\r\n        </a-descriptions>\r\n      </div>\r\n    </a-modal>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted, computed } from 'vue';\r\nimport { message } from 'ant-design-vue';\r\nimport {\r\n  BankOutlined,\r\n  ExportOutlined,\r\n  PlusOutlined,\r\n  SearchOutlined,\r\n  ReloadOutlined,\r\n  FolderOutlined,\r\n  FileOutlined,\r\n  EyeOutlined,\r\n  EditOutlined,\r\n  DeleteOutlined\r\n} from '@ant-design/icons-vue';\r\nimport {\r\n  getDepartments,\r\n  getDepartmentTree,\r\n  createDepartment,\r\n  updateDepartment,\r\n  deleteDepartment,\r\n  getDepartmentStatistics\r\n} from '@/api/organization';\r\nimport { userAPI } from '@/api/users';\r\n\r\n// 响应式数据\r\nconst loading = ref(false);\r\nconst searchText = ref('');\r\nconst statusFilter = ref('');\r\nconst levelFilter = ref('');\r\n\r\nconst modalVisible = ref(false);\r\nconst detailModalVisible = ref(false);\r\nconst isEdit = ref(false);\r\nconst selectedDepartment = ref(null);\r\nconst formRef = ref();\r\n\r\n// 表单数据\r\nconst formData = reactive({\r\n  name: '',\r\n  code: '',\r\n  parent: null,\r\n  manager: null,\r\n  sort_order: 0,\r\n  status: 'active',\r\n  description: ''\r\n});\r\n\r\n// 表单验证规则\r\nconst formRules = {\r\n  name: [{ required: true, message: '请输入部门名称', trigger: 'blur' }],\r\n  code: [{ required: true, message: '请输入部门编码', trigger: 'blur' }],\r\n  status: [{ required: true, message: '请选择状态', trigger: 'change' }]\r\n};\r\n\r\n// 数据\r\nconst departmentList = ref([]);\r\nconst userList = ref([]);\r\nconst departmentTreeDataRef = ref([]);\r\n\r\n\r\n\r\n// 表格列定义\r\nconst columns = [\r\n  {\r\n    title: '部门名称',\r\n    dataIndex: 'name',\r\n    key: 'name'\r\n  },\r\n  {\r\n    title: '部门编码',\r\n    dataIndex: 'code',\r\n    key: 'code'\r\n  },\r\n  {\r\n    title: '上级部门',\r\n    dataIndex: 'parent_name',\r\n    key: 'parent_name'\r\n  },\r\n  {\r\n    title: '负责人',\r\n    dataIndex: 'manager',\r\n    key: 'manager',\r\n    width: 100\r\n  },\r\n  {\r\n    title: '状态',\r\n    key: 'status',\r\n    width: 80\r\n  },\r\n  {\r\n    title: '操作',\r\n    key: 'action',\r\n    width: 200,\r\n    fixed: 'right'\r\n  }\r\n];\r\n\r\n// 分页配置\r\nconst pagination = reactive({\r\n  current: 1,\r\n  pageSize: 10,\r\n  total: 0,\r\n  showSizeChanger: true,\r\n  showQuickJumper: true,\r\n  showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条`\r\n});\r\n\r\n// 计算属性\r\nconst modalTitle = computed(() => {\r\n  return isEdit.value ? '编辑部门' : '新建部门';\r\n});\r\n\r\n// 构建树形数据\r\nconst departmentTreeData = computed(() => {\r\n  // 直接返回从API获取的树形数据\r\n  return departmentTreeDataRef.value;\r\n});\r\n\r\nconst departmentOptions = computed(() => {\r\n  // 构建部门选择器数据\r\n  const buildOptions = (departments) => {\r\n    if (!Array.isArray(departments)) {\r\n      return [];\r\n    }\r\n    return departments.map(dept => ({\r\n      title: dept.name,\r\n      value: dept.id,\r\n      key: dept.id,\r\n      children: dept.children && dept.children.length > 0 ? buildOptions(dept.children) : []\r\n    }));\r\n  };\r\n  return buildOptions(departmentTreeData.value);\r\n});\r\n\r\n// 方法\r\n\r\nconst handleSearch = () => {\r\n  loadDepartments();\r\n};\r\n\r\nconst handleSearchChange = () => {\r\n  if (!searchText.value) {\r\n    loadDepartments();\r\n  }\r\n};\r\n\r\nconst handleFilterChange = () => {\r\n  loadDepartments();\r\n};\r\n\r\nconst resetFilters = () => {\r\n  searchText.value = '';\r\n  statusFilter.value = '';\r\n  levelFilter.value = '';\r\n  loadDepartments();\r\n};\r\n\r\nconst handleTableChange = (pag, filters, sorter) => {\r\n  // 树形表格不需要分页处理\r\n  loadDepartments();\r\n};\r\n\r\nconst loadDepartments = async () => {\r\n  loading.value = true;\r\n  try {\r\n    // 获取树形结构数据\r\n    const response = await getDepartmentTree();\r\n    if (response.status == 200){\r\n      const results = response.data || [];\r\n      console.log('部门树形数据:', results);\r\n      // 直接使用树形数据\r\n      departmentTreeDataRef.value = results;\r\n      // 同时保存扁平化数据用于其他功能\r\n      departmentList.value = flattenTreeData(results);\r\n    }\r\n  } catch (error) {\r\n    console.error('加载部门列表失败:', error);\r\n    message.error('加载部门列表失败');\r\n  } finally {\r\n    loading.value = false;\r\n  }\r\n};\r\n\r\n// 将树形数据扁平化\r\nconst flattenTreeData = (treeData) => {\r\n  const result = [];\r\n  const flatten = (nodes, level = 1) => {\r\n    nodes.forEach(node => {\r\n      result.push({\r\n        ...node,\r\n        level: level\r\n      });\r\n      if (node.children && node.children.length > 0) {\r\n        flatten(node.children, level + 1);\r\n      }\r\n    });\r\n  };\r\n  flatten(treeData);\r\n  return result;\r\n};\r\n\r\nconst showAddModal = () => {\r\n  isEdit.value = false;\r\n  resetForm();\r\n  modalVisible.value = true;\r\n};\r\n\r\nconst addSubDepartment = (record) => {\r\n  isEdit.value = false;\r\n  resetForm();\r\n  formData.parent = record.id;\r\n  modalVisible.value = true;\r\n};\r\n\r\nconst editDepartment = (record) => {\r\n  isEdit.value = true;\r\n  Object.assign(formData, {\r\n    id: record.id,\r\n    name: record.name,\r\n    code: record.code,\r\n    parent: record.parent,\r\n    manager: record.manager,\r\n    sort_order: record.sort_order,\r\n    status: record.status,\r\n    description: record.description\r\n  });\r\n  modalVisible.value = true;\r\n};\r\n\r\nconst viewDepartment = (record) => {\r\n  selectedDepartment.value = record;\r\n  detailModalVisible.value = true;\r\n};\r\n\r\nconst handleDeleteDepartment = async (record) => {\r\n  try {\r\n    await deleteDepartment(record.id);\r\n    message.success('删除成功');\r\n    loadDepartments();\r\n  } catch (error) {\r\n    console.error('删除部门失败:', error);\r\n    message.error('删除失败');\r\n  }\r\n};\r\n\r\nconst handleModalOk = async () => {\r\n  try {\r\n    await formRef.value.validate();\r\n    \r\n    // 准备提交数据，将parent转换为parent_id\r\n    const submitData = { ...formData };\r\n    if (submitData.parent) {\r\n      submitData.parent_id = submitData.parent;\r\n      delete submitData.parent;\r\n    }\r\n    \r\n    if (isEdit.value) {\r\n      await updateDepartment(submitData.id, submitData);\r\n      message.success('更新成功');\r\n    } else {\r\n      await createDepartment(submitData);\r\n      message.success('创建成功');\r\n    }\r\n    \r\n    modalVisible.value = false;\r\n    loadDepartments();\r\n    loadDepartmentTree();\r\n  } catch (error) {\r\n    console.error('保存部门失败:', error);\r\n    \r\n    // 处理表单验证错误\r\n    if (error.errorFields) {\r\n      message.error('请检查表单输入');\r\n      return;\r\n    }\r\n    \r\n    // 处理API返回的错误\r\n    if (error.response && error.response.data) {\r\n      const errorData = error.response.data;\r\n      \r\n      // 处理字段特定错误\r\n      if (errorData.code && Array.isArray(errorData.code)) {\r\n        message.error(`部门编码错误: ${errorData.code[0]}`);\r\n        return;\r\n      }\r\n      \r\n      if (errorData.name && Array.isArray(errorData.name)) {\r\n        message.error(`部门名称错误: ${errorData.name[0]}`);\r\n        return;\r\n      }\r\n      \r\n      // 处理其他字段错误\r\n      const firstErrorField = Object.keys(errorData)[0];\r\n      if (firstErrorField && Array.isArray(errorData[firstErrorField])) {\r\n        message.error(`${firstErrorField}: ${errorData[firstErrorField][0]}`);\r\n        return;\r\n      }\r\n      \r\n      // 处理通用错误消息\r\n      if (errorData.detail) {\r\n        message.error(errorData.detail);\r\n        return;\r\n      }\r\n      \r\n      if (errorData.message) {\r\n        message.error(errorData.message);\r\n        return;\r\n      }\r\n    }\r\n    \r\n    // 默认错误消息\r\n    message.error(isEdit.value ? '更新失败' : '创建失败');\r\n  }\r\n};\r\n\r\nconst handleModalCancel = () => {\r\n  modalVisible.value = false;\r\n  resetForm();\r\n};\r\n\r\nconst resetForm = () => {\r\n  Object.assign(formData, {\r\n    name: '',\r\n    code: '',\r\n    parent: null,\r\n    manager: null,\r\n    sort_order: 0,\r\n    status: 'active',\r\n    description: ''\r\n  });\r\n  if (formRef.value) {\r\n    formRef.value.resetFields();\r\n  }\r\n};\r\n\r\nconst exportDepartments = () => {\r\n  // 导出功能实现\r\n  message.info('导出功能开发中...');\r\n};\r\n\r\nconst filterOption = (input, option) => {\r\n  return option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0;\r\n};\r\n\r\nconst getCurrentCategoryName = () => {\r\n  return '部门管理';\r\n};\r\n\r\nconst refreshData = () => {\r\n  loadDepartments();\r\n};\r\n\r\n// 加载部门树形数据\r\nconst loadDepartmentTree = async () => {\r\n  try {\r\n    const response = await getDepartmentTree();\r\n    const treeData = response.data || response || [];\r\n    departmentTreeData.value = Array.isArray(treeData) ? treeData : [];\r\n  } catch (error) {\r\n    console.error('加载部门树失败:', error);\r\n  }\r\n};\r\n\r\n// 加载用户列表\r\nconst loadUsers = async () => {\r\n  try {\r\n    const response = await userAPI.getUserList();\r\n    const users = response.data?.results || response.data?.data || [];\r\n    userList.value = Array.isArray(users) ? users : [];\r\n  } catch (error) {\r\n    console.error('加载用户列表失败:', error);\r\n  }\r\n};\r\n\r\n// 生命周期\r\nonMounted(() => {\r\n  loadDepartments();\r\n  loadDepartmentTree();\r\n  loadUsers();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n@import '@/assets/admin-common.css';\r\n\r\n/* 部门管理页面特有的样式 */\r\n.departments-layout {\r\n  display: flex;\r\n  gap: 24px;\r\n  min-height: calc(100vh - 200px);\r\n}\r\n\r\n.departments-content.full-width {\r\n  flex: 1;\r\n  width: 100%;\r\n  height: calc(100vh - 200px);\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.departments-content.full-width .ant-card {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.departments-content.full-width .ant-card-body {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 0;\r\n}\r\n\r\n.departments-content.full-width .ant-table-wrapper {\r\n  flex: 1;\r\n  height: 100%;\r\n}\r\n\r\n.departments-content.full-width .ant-table {\r\n  height: 100%;\r\n}\r\n\r\n.departments-content.full-width .ant-table-tbody {\r\n  height: calc(100% - 55px);\r\n  overflow-y: auto;\r\n}\r\n\r\n.department-name {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.level-indent {\r\n  display: inline-block;\r\n}\r\n\r\n.folder-icon,\r\n.file-icon {\r\n  color: #1890ff;\r\n}\r\n\r\n.name-text {\r\n  font-weight: 500;\r\n}\r\n\r\n.manager-info {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.manager-name {\r\n  font-size: 13px;\r\n}\r\n\r\n.no-manager {\r\n  color: #999;\r\n  font-style: italic;\r\n}\r\n\r\n.department-detail {\r\n  padding: 16px 0;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}